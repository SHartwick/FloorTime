var app = angular.module('APP', []);

app.controller('StackedBar',StackedBar)

function StackedBar($scope) {

  var data = {"segments": [{"start": "5", "gender": "M", "environment": "U", "band": "S", "length": "1061", "channelNumber": "1", "speaker": "S0", "showName": "RDEB"}, {"start": "30734", "gender": "M", "environment": "U", "band": "S", "length": "520", "channelNumber": "1", "speaker": "S0", "showName": "RDEB"}, {"start": "1352", "gender": "M", "environment": "U", "band": "S", "length": "1135", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "5888", "gender": "M", "environment": "U", "band": "S", "length": "513", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "6728", "gender": "M", "environment": "U", "band": "S", "length": "583", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "8663", "gender": "M", "environment": "U", "band": "S", "length": "452", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "11963", "gender": "M", "environment": "U", "band": "S", "length": "1168", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "13884", "gender": "M", "environment": "U", "band": "S", "length": "1125", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "20933", "gender": "M", "environment": "U", "band": "S", "length": "1512", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "22876", "gender": "M", "environment": "U", "band": "S", "length": "294", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "23617", "gender": "M", "environment": "U", "band": "S", "length": "740", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "26064", "gender": "M", "environment": "U", "band": "S", "length": "931", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "30372", "gender": "M", "environment": "U", "band": "S", "length": "362", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "32467", "gender": "M", "environment": "U", "band": "S", "length": "1621", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "34930", "gender": "M", "environment": "U", "band": "S", "length": "624", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "35555", "gender": "M", "environment": "U", "band": "S", "length": "320", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "36626", "gender": "M", "environment": "U", "band": "S", "length": "710", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "38389", "gender": "M", "environment": "U", "band": "S", "length": "350", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "39707", "gender": "M", "environment": "U", "band": "S", "length": "1155", "channelNumber": "1", "speaker": "S10", "showName": "RDEB"}, {"start": "6401", "gender": "M", "environment": "U", "band": "S", "length": "153", "channelNumber": "1", "speaker": "S11", "showName": "RDEB"}, {"start": "7311", "gender": "M", "environment": "U", "band": "S", "length": "1352", "channelNumber": "1", "speaker": "S13", "showName": "RDEB"}, {"start": "3072", "gender": "M", "environment": "U", "band": "S", "length": "446", "channelNumber": "1", "speaker": "S15", "showName": "RDEB"}, {"start": "9115", "gender": "M", "environment": "U", "band": "S", "length": "431", "channelNumber": "1", "speaker": "S15", "showName": "RDEB"}, {"start": "10105", "gender": "M", "environment": "U", "band": "S", "length": "280", "channelNumber": "1", "speaker": "S15", "showName": "RDEB"}, {"start": "4841", "gender": "M", "environment": "U", "band": "S", "length": "374", "channelNumber": "1", "speaker": "S16", "showName": "RDEB"}, {"start": "9589", "gender": "M", "environment": "U", "band": "S", "length": "516", "channelNumber": "1", "speaker": "S16", "showName": "RDEB"}, {"start": "19729", "gender": "M", "environment": "U", "band": "S", "length": "416", "channelNumber": "1", "speaker": "S16", "showName": "RDEB"}, {"start": "20466", "gender": "M", "environment": "U", "band": "S", "length": "467", "channelNumber": "1", "speaker": "S16", "showName": "RDEB"}, {"start": "23170", "gender": "M", "environment": "U", "band": "S", "length": "447", "channelNumber": "1", "speaker": "S16", "showName": "RDEB"}, {"start": "37336", "gender": "M", "environment": "U", "band": "S", "length": "1053", "channelNumber": "1", "speaker": "S16", "showName": "RDEB"}, {"start": "2487", "gender": "F", "environment": "U", "band": "S", "length": "585", "channelNumber": "1", "speaker": "S18", "showName": "RDEB"}, {"start": "10756", "gender": "F", "environment": "U", "band": "S", "length": "616", "channelNumber": "1", "speaker": "S18", "showName": "RDEB"}, {"start": "18741", "gender": "F", "environment": "U", "band": "S", "length": "510", "channelNumber": "1", "speaker": "S18", "showName": "RDEB"}, {"start": "19308", "gender": "F", "environment": "U", "band": "S", "length": "421", "channelNumber": "1", "speaker": "S18", "showName": "RDEB"}, {"start": "11372", "gender": "M", "environment": "U", "band": "S", "length": "591", "channelNumber": "1", "speaker": "S19", "showName": "RDEB"}, {"start": "26995", "gender": "M", "environment": "U", "band": "S", "length": "970", "channelNumber": "1", "speaker": "S19", "showName": "RDEB"}, {"start": "1066", "gender": "F", "environment": "U", "band": "S", "length": "286", "channelNumber": "1", "speaker": "S2", "showName": "RDEB"}, {"start": "31254", "gender": "F", "environment": "U", "band": "S", "length": "519", "channelNumber": "1", "speaker": "S2", "showName": "RDEB"}, {"start": "13131", "gender": "M", "environment": "U", "band": "S", "length": "753", "channelNumber": "1", "speaker": "S22", "showName": "RDEB"}, {"start": "15009", "gender": "M", "environment": "U", "band": "S", "length": "900", "channelNumber": "1", "speaker": "S25", "showName": "RDEB"}, {"start": "17321", "gender": "M", "environment": "U", "band": "S", "length": "991", "channelNumber": "1", "speaker": "S25", "showName": "RDEB"}, {"start": "15909", "gender": "M", "environment": "U", "band": "S", "length": "976", "channelNumber": "1", "speaker": "S26", "showName": "RDEB"}, {"start": "16885", "gender": "M", "environment": "U", "band": "S", "length": "436", "channelNumber": "1", "speaker": "S28", "showName": "RDEB"}, {"start": "18312", "gender": "M", "environment": "U", "band": "S", "length": "429", "channelNumber": "1", "speaker": "S30", "showName": "RDEB"}, {"start": "22445", "gender": "M", "environment": "U", "band": "S", "length": "431", "channelNumber": "1", "speaker": "S30", "showName": "RDEB"}, {"start": "3620", "gender": "M", "environment": "U", "band": "S", "length": "285", "channelNumber": "1", "speaker": "S33", "showName": "RDEB"}, {"start": "4289", "gender": "M", "environment": "U", "band": "S", "length": "477", "channelNumber": "1", "speaker": "S33", "showName": "RDEB"}, {"start": "24357", "gender": "M", "environment": "U", "band": "S", "length": "300", "channelNumber": "1", "speaker": "S43", "showName": "RDEB"}, {"start": "24666", "gender": "M", "environment": "U", "band": "S", "length": "323", "channelNumber": "1", "speaker": "S43", "showName": "RDEB"}, {"start": "24990", "gender": "M", "environment": "U", "band": "S", "length": "381", "channelNumber": "1", "speaker": "S43", "showName": "RDEB"}, {"start": "25474", "gender": "M", "environment": "U", "band": "S", "length": "590", "channelNumber": "1", "speaker": "S44", "showName": "RDEB"}, {"start": "27965", "gender": "M", "environment": "U", "band": "S", "length": "580", "channelNumber": "1", "speaker": "S48", "showName": "RDEB"}, {"start": "28817", "gender": "F", "environment": "U", "band": "S", "length": "312", "channelNumber": "1", "speaker": "S49", "showName": "RDEB"}, {"start": "29129", "gender": "M", "environment": "U", "band": "S", "length": "1243", "channelNumber": "1", "speaker": "S50", "showName": "RDEB"}, {"start": "5239", "gender": "M", "environment": "U", "band": "S", "length": "649", "channelNumber": "1", "speaker": "S54", "showName": "RDEB"}, {"start": "32066", "gender": "M", "environment": "U", "band": "S", "length": "354", "channelNumber": "1", "speaker": "S54", "showName": "RDEB"}, {"start": "34088", "gender": "F", "environment": "U", "band": "S", "length": "842", "channelNumber": "1", "speaker": "S58", "showName": "RDEB"}, {"start": "35875", "gender": "M", "environment": "U", "band": "S", "length": "751", "channelNumber": "1", "speaker": "S60", "showName": "RDEB"}, {"start": "38739", "gender": "M", "environment": "U", "band": "S", "length": "968", "channelNumber": "1", "speaker": "S65", "showName": "RDEB"}], "meta": [{"MTScore": "-Infinity", "FSScore": "-Infinity", "speaker": "S0", "MSScore": "-Infinity", "FTScore": "-Infinity"}, {"MTScore": "-33.10230716757095", "FSScore": "-32.93334070251018", "speaker": "S10", "MSScore": "-32.45713350842344", "FTScore": "-33.54416808549157"}, {"MTScore": "-34.817763873263694", "FSScore": "-34.44127344732635", "speaker": "S11", "MSScore": "-34.221445177139955", "FTScore": "-34.84854519886584"}, {"MTScore": "-33.382760589647994", "FSScore": "-32.6288165405866", "speaker": "S13", "MSScore": "-32.55337002804523", "FTScore": "-33.452870827943464"}, {"MTScore": "-33.36997925171681", "FSScore": "-32.98532242067624", "speaker": "S15", "MSScore": "-32.9198729823695", "FTScore": "-33.23942876987247"}, {"MTScore": "-33.02830424346084", "FSScore": "-32.84808961539366", "speaker": "S16", "MSScore": "-32.40780778730507", "FTScore": "-33.01829414406842"}, {"MTScore": "-33.610925446105405", "FSScore": "-33.02216597123711", "speaker": "S18", "MSScore": "-33.236394901223555", "FTScore": "-33.50602111281175"}, {"MTScore": "-33.32140963629036", "FSScore": "-32.94887379661986", "speaker": "S19", "MSScore": "-32.82029129048623", "FTScore": "-33.23121811204746"}, {"MTScore": "-34.103659763917996", "FSScore": "-32.885611558102376", "speaker": "S2", "MSScore": "-33.61346671940036", "FTScore": "-33.69645045147397"}, {"MTScore": "-32.875059648018166", "FSScore": "-32.55145892987948", "speaker": "S22", "MSScore": "-32.45424199014809", "FTScore": "-32.77766206989525"}, {"MTScore": "-33.25413645179306", "FSScore": "-33.16020703717917", "speaker": "S25", "MSScore": "-32.8977142079211", "FTScore": "-33.46937944484418"}, {"MTScore": "-32.823995918756545", "FSScore": "-32.85442941951636", "speaker": "S26", "MSScore": "-32.554629664877055", "FTScore": "-32.84208209483716"}, {"MTScore": "-33.296644179110544", "FSScore": "-33.55182540199393", "speaker": "S28", "MSScore": "-33.128255908203336", "FTScore": "-33.92110509020151"}, {"MTScore": "-32.600162647218184", "FSScore": "-32.467386884806466", "speaker": "S30", "MSScore": "-31.538336742081963", "FTScore": "-32.7725237315132"}, {"MTScore": "-34.05740506209284", "FSScore": "-33.99676111421128", "speaker": "S33", "MSScore": "-33.8626464306355", "FTScore": "-34.14606643320414"}, {"MTScore": "-32.60995388542778", "FSScore": "-33.03430950815738", "speaker": "S43", "MSScore": "-31.61933518880068", "FTScore": "-33.307054480389404"}, {"MTScore": "-33.16318031973017", "FSScore": "-33.21738410851631", "speaker": "S44", "MSScore": "-32.44802782939169", "FTScore": "-33.70355354907162"}, {"MTScore": "-32.755591558421266", "FSScore": "-32.386394790835084", "speaker": "S48", "MSScore": "-32.38259642952595", "FTScore": "-32.90651783216243"}, {"MTScore": "-34.88095624073573", "FSScore": "-33.93791383837386", "speaker": "S49", "MSScore": "-34.28382735251385", "FTScore": "-34.65638748883169"}, {"MTScore": "-32.86311934073092", "FSScore": "-32.51776470166381", "speaker": "S50", "MSScore": "-32.512406882073705", "FTScore": "-32.81064369043516"}, {"MTScore": "-32.3578655052736", "FSScore": "-32.30446331500001", "speaker": "S54", "MSScore": "-31.75007604836175", "FTScore": "-32.91760719699581"}, {"MTScore": "-34.104753487370196", "FSScore": "-32.097330475998724", "speaker": "S58", "MSScore": "-33.518748674715404", "FTScore": "-32.90293761527664"}, {"MTScore": "-32.91573166796548", "FSScore": "-32.446096701385294", "speaker": "S60", "MSScore": "-32.158282313049945", "FTScore": "-32.909673913878976"}, {"MTScore": "-33.26678759689502", "FSScore": "-33.01127289307956", "speaker": "S65", "MSScore": "-32.87353566557972", "FTScore": "-33.402374157042246"}]};

  console.log(data);

  var rawSegments = data.segments.sort(function(seg1,seg2){
    return 1*seg1.start - 1*seg2.start;
  });

  var speakerColors = {};
  var totalLength = 0;
  var lastSegmentEnd = 0;
  $scope.segments = [];
  rawSegments.forEach(function(segment){
    if( lastSegmentEnd < segment.start){
      $scope.segments.push({
        speaker: 'BL',
        color: '#eee',
        start: lastSegmentEnd,
        length: segment.start - lastSegmentEnd
      })
    }
    if(segment.start + segment.length > totalLength){
      totalLength = segment.start + segment.length;
    }
    if(!(segment.speaker in speakerColors)){
      speakerColors[segment.speaker] = assignColor();
    }

    segment.color = speakerColors[segment.speaker];
    lastSegmentEnd = segment.start + segment.length;

    $scope.segments.push(segment)


  });

  $scope.segments = $scope.segments.sort(function(seg1,seg2){
    return 1*seg1.start - 1*seg2.start;
  });

  console.log(totalLength);

  $scope.percentage = function(length){
    return 100000*length/totalLength;
  }
  // $scope.segs = data.segments.sort(function(seg1,seg2){
  //   return seg2.start - seg1.start;
  // });

  function assignColor(){
    return 'rgb('+Math.floor(Math.random()*255)+','+Math.floor(Math.random()*255)+','+Math.floor(Math.random()*255)+')';
  }


  //$scope.


}
